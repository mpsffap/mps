- name: Get list of identity names for this host
  ansible.builtin.set_fact:
    user: >-
      {{
        users
        | selectattr('name', 'equalto', hostuser)
        | selectattr('config_terminal', 'equalto', true)
        | list
        | first
        | default({}, true)
      }}
  no_log: "{{ respect_nolog }}"

- name: Copy vim config
  ansible.builtin.copy:
    src: "{{ src_dotfiles }}/{{ item }}"
    dest: "{{ user.homedir }}/{{ item }}"
    owner: "{{ user.accname }}"
    group: "{{ user.accname }}"
    mode: "0700"
  loop: "{{ vim_files }}"
  when: vim_files is defined and user != {}
